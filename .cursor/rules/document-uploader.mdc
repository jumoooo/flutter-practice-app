---
alwaysApply: false
globs: "*.md"
description: "Document Uploader - 마크다운 파일 자동 업로드 규칙"
---

## Internal Instructions (English)

- Purpose: When the user asks to **upload markdown files (e.g., to Notion)**, prefer using `documentUploader`.
- Scope: Applies to `.md` files and upload-related requests.
- Behavior:
  - `documentUploader` does all planning, API/Browser decisions, and error handling logic in English.
  - All user-facing plans, progress reports, and error messages must be in Korean.

## 사용자용 설명 (한글)

# Document Uploader 규칙

이 규칙은 마크다운 파일 작업 시 적용됩니다.

## 자동 호출

다음 상황에서 `documentUploader` Agent가 자동으로 제안됩니다:
- 마크다운 파일(`.md`) 작업 시
- "문서 업로드", "Notion에 올려줘", "파일 업로드" 등의 키워드
- Orchestrator가 문서 업로드 작업을 식별한 경우

## Agent 사용 방법

마크다운 파일 업로드 요청 시:
1. [documentUploader.md](mdc:.cursor/agents/documentUploader.md)의 Agent를 사용
2. [document_upload_skills.md](mdc:.cursor/skills/document_upload_skills.md)의 Skills를 참조
3. 업로드 계획을 수립하고 사용자 확인 후 진행
4. 단계별 검증을 통해 안정성 보장
5. 기존 데이터를 절대 수정하거나 삭제하지 않음

## 핵심 규칙

### 안정성 우선
- 업로드 전 계획 수립 및 사용자 확인 필수
- MCP API 방법 우선 사용 (브라우저 없이 빠르고 안정적)
- API 실패 시에만 브라우저 자동화로 전환 (네트워크/타임아웃 계열만 재시도)
- 에러 발생 시 즉시 보고 및 사용자 확인

### 데이터 보존
- 기존 페이지 내용을 절대 삭제하지 않음
- 기존 내용이 있으면 하단에만 추가
- 제목이 이미 있으면 변경하지 않음

### 검증 전략 (간소화)
- **MCP API 방법**: 최소 검증 (API가 대부분 처리)
  - API 응답 확인 (page ID, URL 존재)
  - 선택적: 페이지 존재 확인
- **브라우저 방법** (Fallback): 더 많은 검증 필요
  - 제목 검증, 내용 영역 확인, 최종 내용 검증

### 중복 생성 방지 및 기본값
- 같은 부모 페이지에 동일 제목의 하위 페이지가 이미 있는지 먼저 확인
- 이미 존재할 경우: 새 페이지 생성/기존 페이지에 추가/중단 중 하나를 사용자에게 선택받음
- 부모 페이지가 명시되지 않은 경우: 기본 루트에 바로 생성하지 않고, 먼저 위치를 사용자에게 물어본 뒤 진행

## MCP 도구 활용 (최우선 전략)

**⚡ 중요: MCP API를 항상 최우선으로 시도하세요!**

Agent는 다음 MCP 도구를 활용합니다:
- **Notion MCP (최우선)**: API 방식 업로드 - 브라우저 없이 빠르고 안정적
  - `notion-fetch`: 부모 페이지 정보 확인
  - `notion-create-pages`: 페이지 생성 + 내용 업로드를 한 번에 처리
    - **⚠️ CRITICAL**: parent page ID는 **하이픈 없는 32자 hex UUID** 필수
    - 올바른 예: `"2939168184838094b94bc4ad6aab8c88"` (하이픈 제거)
    - 잘못된 예: `"29391681-8483-8094-b94b-c4ad6aab8c88"` (하이픈 포함 - API 실패)
    - 코드: `parentPageId.replace(/-/g, "")` 반드시 사용
    - **같은 형식만 반복 재시도 금지**: 하이픈 포함 형식으로 실패하면 하이픈 제거 형식으로 재시도
  - **성공 사례**: 최근 업로드에서 브라우저 없이 성공적으로 완료
- **Playwright MCP (Fallback)**: 브라우저 자동화 - API 실패 시에만 사용
- **Codebase Search**: 파일 검색 및 분석

**작업 순서**:
1. **항상 먼저**: Notion MCP API로 시도 (부모 페이지 + 내용 한 번에 업로드)
2. **재시도**: API 실패 시 2회 재시도
3. **Fallback**: API가 모두 실패한 경우에만 브라우저 자동화 사용

## 중요 사항

- 모든 사용자 응답은 한글로 제공
- 진행 상황을 단계별로 보고
- 사용자 확인 없이 진행하지 않음
- 안정성이 속도보다 우선

Agent 파일 참조: [documentUploader.md](mdc:.cursor/agents/documentUploader.md)
Skills 파일 참조: [document_upload_skills.md](mdc:.cursor/skills/document_upload_skills.md)
